<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Advanced Usage</title>
	
	<meta name="author" content="Jonny W">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-53289013-1', 'auto');
        ga('send', 'pageview');
    </script>

</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			
            <iframe src="http://ghbtns.com/github-btn.html?user=jonnnnyw&repo=php-phantomjs&type=fork&count=true"
                allowtransparency="true" frameborder="0" scrolling="0" width="85" height="20" class="nav-link last"></iframe>
    		
			
			
            <iframe src="http://ghbtns.com/github-btn.html?user=jonnnnyw&repo=php-phantomjs&type=watch&count=true"
                allowtransparency="true" frameborder="0" scrolling="0" width="85" height="20" class="nav-link"></iframe>
    		
    		
			<a class="navbar-brand" href="/">
				<img src="/assets/media/phantomjs-small.png" class="img-circle" />
				PHP PhantomJs
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/installation.html">Installation</a></li>
				<li><a href="/usage.html">Usage</a></li>
				<li><a href="/advanced.html">Advanced</a></li>
				<li><a href="/troubleshooting.html">Troubleshooting</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
		    <li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/installation.html"><i class="fa fa-folder"></i>Installation</a></li>
			<li><a href="/usage.html"><i class="fa fa-folder"></i>Usage</a></li>
			<li><a href="/advanced.html"><i class="fa fa-folder"></i>Advanced</a></li>
			<li><a href="/troubleshooting.html"><i class="fa fa-folder"></i>Troubleshooting</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/media/phantomjs.png" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">PHP PhantomJs</a>
    </h3>
</header>


<div id="bio" class="text-center">
	Run PhantomJS scripts through PHP
</div>


<div id="contact-list" class="text-center">

	<ul class="list-unstyled list-inline">
		
		<li>
            <iframe src="http://ghbtns.com/github-btn.html?user=jonnnnyw&repo=php-phantomjs&type=watch&count=true"
                allowtransparency="true" frameborder="0" scrolling="0" width="83" height="20"></iframe>
		</li>
		
		
		<li>
			<iframe src="http://ghbtns.com/github-btn.html?user=jonnnnyw&repo=php-phantomjs&type=fork&count=true"
                allowtransparency="true" frameborder="0" scrolling="0" width="83" height="20"></iframe>
		</li>
		
	</ul>

</div>
<! -- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Advanced Usage </h1>
</div>
	
<article>

	<div class="col-sm-10">
	
	  <div class="article_body">
	  <ul>
  <li><a href="#phantomjs-command-line-options">PhantomJS command line options</a></li>
  <li><a href="#custom-phantom-js-scripts">Custom PhantomJS scripts</a>
    <ul>
      <li><a href="#writing-a-custom-script">Writing a custom script</a></li>
      <li><a href="#using-custom-request-parameters-in-your-script">Using custom request parameters in your script</a></li>
      <li><a href="#loading-your-script">Loading your script</a></li>
    </ul>
  </li>
</ul>

<h2 id="phantomjs-command-line-options">PhantomJS command line options</h2>

<p>The PhantomJS API contains a range of command line options that can be passed when executing the PhantomJS executable. These can also be passed in via the client before a request:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Client</span><span class="p">;</span>
    
    <span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;--load-images=true&#39;</span><span class="p">);</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;--ignore-ssl-errors=true&#39;</span><span class="p">);</span>
    
    <span class="nv">$request</span>  <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createRequest</span><span class="p">(</span><span class="s1">&#39;http://google.com&#39;</span><span class="p">);</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createResponse</span><span class="p">();</span>

    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">);</span></code></pre></div>

<p>You can also set a path to a JSON configuration file that contains multiple PhantomJS options:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Client</span><span class="p">;</span>
    
    <span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">addOption</span><span class="p">(</span><span class="s1">&#39;--config=/path/to/config.json&#39;</span><span class="p">);</span>
    
    <span class="nv">$request</span>  <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createRequest</span><span class="p">(</span><span class="s1">&#39;http://google.com&#39;</span><span class="p">);</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createResponse</span><span class="p">();</span>

    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">);</span></code></pre></div>

<p>See the <a href="http://phantomjs.org/api/command-line.html">PhantomJS Documentation</a> for a full list of command line options.</p>

<h2 id="custom-phantomjs-scripts">Custom PhantomJS scripts</h2>

<p>In most instances you shouldn’t need to worry about the javascript files that run the PHP PhantomJS library but there may be times when you want to execute your own custom PhantomJS scripts through the client. This can be easily achieved by using the built in script loader.</p>

<p>Script files or ‘procedures’ as they are referred to in the application are closely mapped to requests. When you create a default request instance, you are essentially running the default javascript procedure that comes bundled with the application. When you create a capture request you are running the capture procedure.</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Client</span><span class="p">;</span>
    
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createRequest</span><span class="p">();</span> <span class="c1">// ~/Resources/procedures/default.proc</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createCaptureRequest</span><span class="p">();</span> <span class="c1">// ~/Resources/procedures/capture.proc</span></code></pre></div>

<h3 id="writing-a-custom-script">Writing a custom script</h3>

<p>The first step in creating your script is to create a procedure file somewhere. For the purpose of this guide we will refer to it as <code>my_procedure.proc</code> but in reality it can be called anything you like. The only requirement is that the file extension must be <code>.proc</code>.</p>

<p>Create the file somewhere and make sure it can be read by your application. Make a note of the path to the directory where your file is created as you will need this when loading your script which is explained later in this guide.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#bash</span>
    
    <span class="nv">$ </span>touch my_procedure.proc
    <span class="nv">$ </span>chmod <span class="m">755</span> my_procedure.proc</code></pre></div>

<p>Next open your procedure file in your text editor and write your PhantomJS script. The <a href="http://phantomjs.org/quick-start.html">PhantomJS documentation</a> has more detailed information on writing custom scripts.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// my_procedure.proc</span>

    <span class="kd">var</span> <span class="nx">page</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpage&#39;</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span>
    
    <span class="nx">page</span><span class="p">.</span><span class="nx">open</span> <span class="p">(</span><span class="s1">&#39;{{ request.getUrl() }}&#39;</span><span class="p">,</span> <span class="s1">&#39;{{ request.getMethod() }}&#39;</span><span class="p">,</span> <span class="s1">&#39;{{ request.getBody() }}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
         
        <span class="c1">// It is important that you exit PhantomJS</span>
        <span class="c1">// when your script has run or when you</span>
        <span class="c1">// encounter an error</span>
        <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="p">...</span></code></pre></div>

<blockquote>
  <h4 id="important">Important</h4>
  <p>Make sure that <code>phantom.exit(1);</code> is always called after your script has run or if you encounter an error. This requires you to take care when handling PhantomJS errors to ensure that you exit the PhantomJS script, whether the script was successfully executed or not. If you do not call <code>phantom.exit(1);</code> then PhantomJS will continue to run until your PHP script times out. If you find that your custom script is hanging then this is most likely the cause.</p>
</blockquote>

<p>It is a good practice to create a global error handler in your script that exits PhantomJS:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// my_procedure.proc</span>

    <span class="nx">phantom</span><span class="p">.</span><span class="nx">onError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">trace</span><span class="p">)</span> <span class="p">{</span>
  
        <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="p">...</span></code></pre></div>

<h3 id="using-custom-request-parameters-in-your-script">Using custom request parameters in your script</h3>

<p>Before a procedure is executed by the application it is parsed through a template parser. The PHP PhantomJS library uses the popular <a href="https://github.com/fabpot/Twig">Twig templating engine</a>. This gives you access to all the <a href="http://twig.sensiolabs.org/doc/templates.html">Twig niceness</a> which you can use in your custom scripts.</p>

<p>You may have noticed in the example above that we have used some Twig template tags referencing a request object e.g. <code>{{ request.getUrl() }}</code>. This is in fact the PHP request instance that you created and passed to the client when sending your request, which is injected into the Twig template parser. As a result you gain full access to all the data contained within the request instance, via the data accessor methods.</p>

<p>A default request instance contains the following accessors:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Accessor</th>
      <th>Description</th>
      <th style="text-align: center">Twig example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">getMethod()</td>
      <td>The request method e.g. GET.</td>
      <td style="text-align: center">{{ request.getMethod() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getTimeout()</td>
      <td>The request timeout period in milliseconds.</td>
      <td style="text-align: center">{{ request.getTimeout() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getDelay()</td>
      <td>The page render delay in seconds.</td>
      <td style="text-align: center">{{ request.getDelay() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getUrl()</td>
      <td>The request URL.</td>
      <td style="text-align: center">{{ request.getUrl() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getBody()</td>
      <td>The request body (POST, PUT).</td>
      <td style="text-align: center">{{ request.getBody() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getHeaders(<em>format</em>)</td>
      <td>The request headers.</td>
      <td style="text-align: center">{{ request.getHeaders(‘json’) }}</td>
    </tr>
  </tbody>
</table>

<p>A capture request contains a few additional ones:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Accessor</th>
      <th>Description</th>
      <th style="text-align: center">Twig example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">getRectTop()</td>
      <td>The x coordinate of the capture region.</td>
      <td style="text-align: center">{{ request.getRectTop() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getRectLeft()</td>
      <td>The y coordinate of the capture region.</td>
      <td style="text-align: center">{{ request.getRectLeft() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getRectWidth()</td>
      <td>The width of the capture region.</td>
      <td style="text-align: center">{{ request.getRectWidth() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getRectHeight()</td>
      <td>The height of the capture region.</td>
      <td style="text-align: center">{{ request.getRectHeight() }}</td>
    </tr>
    <tr>
      <td style="text-align: center">getCaptureFile()</td>
      <td>The file to save the capture to.</td>
      <td style="text-align: center">{{ request.getCaptureFile() }}</td>
    </tr>
  </tbody>
</table>

<p>If you would like to inject additional data into your script through custom accessors, simply extend the request class with your own:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Message\Request</span><span class="p">;</span>
    
    <span class="k">class</span> <span class="nc">CustomRequest</span> <span class="k">extends</span> <span class="nx">Request</span>
    <span class="p">{</span>
    
        <span class="k">public</span> <span class="k">function</span> <span class="nf">getSomething</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;Something!&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></div>

<p>Now you will be able to access the data in your custom script when using your custom request:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// my_procedure.proc</span>

    <span class="kd">var</span> <span class="nx">something</span> <span class="o">=</span> <span class="s1">&#39;{{ request.getSomething() }}&#39;</span><span class="p">;</span> <span class="c1">// Get something</span>
    
    <span class="p">...</span></code></pre></div>

<p>And to use your custom request simply create a new instance of it and pass it to the client:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Client</span><span class="p">;</span>
    
    <span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createResponse</span><span class="p">();</span>
    
    <span class="nv">$request</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomRequest</span><span class="p">();</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setMethod</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">);</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setUrl</span><span class="p">(</span><span class="s1">&#39;http://www.google.com&#39;</span><span class="p">);</span>
    
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">);</span></code></pre></div>

<h3 id="loading-your-script">Loading your script</h3>

<p>Now that you have your custom script and you’ve added your custom request parameters, you may be wondering how to tell the client to actually load your script. This is done by creating a procedure loader and telling it where to find your script files.</p>

<p>The service container has a factory that makes creating a new procedure loader easy:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    
    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Client</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\DependencyInjection\ServiceContainer</span><span class="p">;</span>
    
    <span class="nv">$location</span> <span class="o">=</span> <span class="s1">&#39;/path/to/your/procedure/directory&#39;</span><span class="p">;</span>
    
    <span class="nv">$serviceContainer</span> <span class="o">=</span> <span class="nx">ServiceContainer</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    
    <span class="nv">$procedureLoader</span> <span class="o">=</span> <span class="nv">$serviceContainer</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;procedure_loader_factory&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">createProcedureLoader</span><span class="p">(</span><span class="nv">$location</span><span class="p">);</span>
        
    <span class="o">...</span></code></pre></div>

<p>The client contains a chain procedure loader which lets you set multiple loaders at the same time. Ultimately this means that you can load your custom scripts while still maintaining the ability to load the default scripts if you choose. </p>

<p>Now add your procedure loader to the chain loader:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="o">...</span>
    
    <span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getProcedureLoader</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addLoader</span><span class="p">(</span><span class="nv">$procedureLoader</span><span class="p">);</span>
    
    <span class="o">...</span></code></pre></div>

<p>The last thing you need to do is to tell the request which script you want to load for that request. This is done by setting the request type to the name of your procedure file, minus the extension:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="o">...</span>
    
   <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createRequest</span><span class="p">();</span>
   <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setType</span><span class="p">(</span><span class="s1">&#39;my_procedure&#39;</span><span class="p">);</span>
    
    <span class="o">...</span></code></pre></div>

<p>Or if you are using a custom request as outlined in the <a href="#using-custom-request-parameters-in-your-script">custom request parameters</a> section, you can implement a <code>getType()</code> method which returns the name of your procedure, eliminating the need to set the request type for each request:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Message\Request</span><span class="p">;</span>
    
    <span class="k">class</span> <span class="nc">CustomRequest</span> <span class="k">extends</span> <span class="nx">Request</span>
    <span class="p">{</span>
    
        <span class="k">public</span> <span class="k">function</span> <span class="nf">getType</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;my_procedure&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></div>

<p>Below is a full example for clarity:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    
    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\Client</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">JonnyW\PhantomJs\DependencyInjection\ServiceContainer</span><span class="p">;</span>
    
    <span class="nv">$location</span> <span class="o">=</span> <span class="s1">&#39;/path/to/your/procedure/directory&#39;</span><span class="p">;</span>
    
    <span class="nv">$serviceContainer</span> <span class="o">=</span> <span class="nx">ServiceContainer</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    
    <span class="nv">$procedureLoader</span> <span class="o">=</span> <span class="nv">$serviceContainer</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;procedure_loader_factory&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">createProcedureLoader</span><span class="p">(</span><span class="nv">$location</span><span class="p">);</span>
        
    <span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getProcedureLoader</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addLoader</span><span class="p">(</span><span class="nv">$procedureLoader</span><span class="p">);</span>
    
    <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createRequest</span><span class="p">();</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setType</span><span class="p">(</span><span class="s1">&#39;my_procedure&#39;</span><span class="p">);</span>
    
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getMessageFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createResponse</span><span class="p">();</span>
    
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">);</span></code></pre></div>

<blockquote>
  <h4 id="troubleshooting">Troubleshooting</h4>
  <p>If you find that your script isn’t running or that you are receiving a status of ‘0’ back in the response, chances are you have a syntax error in you script. It pays to turn debugging on in the client <code>$client-&gt;debug(true)</code> which will then give you access to some log information through <code>$client-&gt;getLog()</code>.</p>
</blockquote>

<p>See more detailed information about <a href="/debugging.html">debugging</a>.</p>

	  </div>

    </div>

    <div class="clearfix"></div>
    
    <hr>
    <ul class="pager">
        
        <li class="previous"><a href="/usage.html" title="Usage">&larr; Usage</a></li>
        
        
        <li class="next"><a href="/troubleshooting.html" title="Troubleshooting">Troubleshooting &rarr;</a></li>
        
    </ul>

	
    
</article>




		<footer>
			<hr/>
			<p>
				&copy; 2014 PHP PhantomJs. Theme: Modified <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
	
</body>
</html>

